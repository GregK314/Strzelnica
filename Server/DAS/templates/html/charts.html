<!doctype html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="{% static 'DAS/bootstrap-5.1.3-dist/css/bootstrap.min.css' %}">
    <script src="{% static 'DAS/bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js' %}" crossorigin="anonymous"></script>
    <script src="{% static 'DAS/chart.js-3.6.2/chart.min.js' %}" crossorigin="anonymous"></script>
    <script src="{% static 'DAS/jquery-3.6.0.min.js' %}" crossorigin="anonymous"></script>
    <script src="{% static 'DAS/chart.js-3.6.2/chartjs-plugin-colorschemes.js' %}" crossorigin="anonymous"></script>
</head>

<body>
    <canvas class="my-4 w-100" id="myChart" width="900" height="380"></canvas>
</body>

<script type="text/javascript">
    $(document).ready(function () {
        init_chart()
        read_database()
    });
    function init_chart() {
        var ctx = document.getElementById('myChart')
        window.myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: []
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: false
                        }
                    }]
                },
                legend: {
                    display: true
                }
            }
        })

    }
    function update_chart(data) {
        window.myChart.data.labels = data.labels
        if (window.myChart.data.datasets.length < data.datasets.length) {
            while (window.myChart.data.datasets.length < data.datasets.length) {
                window.myChart.data.datasets.push(generate_dataset(window.myChart.data.datasets.length))
            }

        } else if (window.myChart.data.datasets.length > data.datasets.length) {

        }
        for (let i = 0; i < data.datasets.length; i++) {
            window.myChart.data.datasets[i].data = data.datasets[i].data
            window.myChart.data.datasets[i].label = data.datasets[i].label
        }
        window.myChart.update()
    }
    function generate_dataset() {
        return {
            label: "",
            data: [],
            lineTension: 0,
            backgroundColor: 'transparent',
            borderColor: '#007bff',
            borderWidth: 4,
            pointBackgroundColor: '#007bff'
        }
    }
    function read_database() {
        $.get("get",
            function (data) {
                update_chart(data)
            });
    }

</script>

</html>